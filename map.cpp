#include "game.h"
#include "map.h"
#include "tiles.h"
#include "misc.h"

int distancesquared(int i1, int j1, int i2, int j2) {
	int idiff = i1-i2;
	int jdiff = j1-j2;
	return (idiff*idiff)+(jdiff*jdiff);
}

void getRandomOpenSpot(int *targeti, int *targetj, bool visible) {
	do { // Pick a random open target on the map
		*targeti = random_between(0, MAP_WIDTH-1);
		*targetj = random_between(0, MAP_HEIGHT-1);
	} while (
		map[TILE_TO_INDEX(*targeti, *targetj)] != 0 && (!visible || (
			map[TILE_TO_INDEX(*targeti, (*targetj)-1)] != 0 &&
			map[TILE_TO_INDEX((*targeti)+1, (*targetj)-1)] != 0
		)
	));
}

const unsigned char floor[MAP_WIDTH*MAP_HEIGHT] = {
48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,
48,42,43,42,43,42,43,42,48,33,33,33,48,33,33,33,48,33,33,33,48,33,33,33,33,33,33,48,44,39,39,39,39,39,39,39,39,39,45,48,
48,43,42,43,42,43,42,43,48,33,48,33,33,33,48,33,48,33,48,33,48,33,43,43,43,43,33,48,38,33,33,33,41,41,33,33,41,33,40,48,
48,42,43,42,43,42,43,42,48,33,33,33,48,33,33,33,48,33,33,33,48,33,33,33,33,33,33,48,38,33,41,41,39,39,41,41,39,33,40,48,
48,43,42,43,42,43,42,48,48,48,33,48,48,48,33,48,48,48,33,48,48,48,33,48,48,48,48,48,38,33,39,39,41,41,39,39,41,33,40,48,
48,42,43,42,43,42,35,33,48,33,33,33,48,33,33,33,48,33,33,33,48,33,33,33,33,33,33,48,38,33,41,41,39,39,41,41,39,33,40,48,
48,48,48,48,48,48,33,33,33,33,43,33,48,33,43,33,48,33,43,33,33,33,43,43,43,43,33,33,33,33,39,39,41,41,39,39,41,33,40,48,
48,33,33,33,33,48,33,33,48,33,43,33,48,33,43,33,48,33,43,33,48,33,33,33,33,33,33,48,38,33,41,41,39,39,41,41,39,33,40,48,
48,33,43,43,33,33,33,33,48,33,43,33,48,33,43,33,48,33,43,33,48,48,48,48,48,48,48,48,38,33,39,39,41,41,39,39,41,33,40,48,
48,33,43,43,33,48,33,33,48,33,33,33,48,33,33,33,48,33,33,33,48,33,33,33,33,33,33,48,38,33,33,33,39,39,33,33,39,33,40,48,
48,33,43,43,33,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,33,48,48,33,48,33,48,47,41,41,33,41,41,41,41,41,41,46,48,
48,33,43,43,33,48,33,33,33,33,48,33,33,33,48,33,33,33,33,33,33,33,33,48,33,48,33,48,48,48,48,33,48,48,48,48,48,48,48,48,
48,33,43,43,33,33,33,43,43,33,33,33,43,33,48,33,43,43,43,43,43,43,33,48,33,48,33,33,33,48,33,33,33,48,33,33,33,33,33,48,
48,33,33,33,33,48,33,33,33,33,48,33,43,33,48,33,43,43,43,43,43,43,33,48,33,48,48,48,33,48,33,43,33,48,33,37,48,34,33,48,
48,48,48,33,48,48,48,48,48,48,48,33,43,33,48,33,33,33,33,33,33,43,33,48,48,48,33,48,33,33,33,43,33,48,33,48,48,48,33,48,
48,33,33,33,33,33,33,33,33,33,48,33,43,33,33,33,33,48,48,48,33,43,33,33,33,33,33,48,48,48,33,43,33,33,33,36,48,35,33,48,
48,40,38,33,33,43,43,43,43,33,33,33,43,33,48,33,33,48,48,48,33,43,33,48,33,33,33,33,33,48,33,33,33,48,33,33,33,33,33,48,
48,40,38,48,33,43,33,33,33,33,48,33,33,33,48,33,33,33,33,33,33,43,33,48,48,48,48,48,33,48,48,33,48,48,48,48,48,48,48,48,
48,40,38,48,33,43,33,48,48,48,48,48,48,48,48,33,33,33,33,33,33,43,33,48,33,33,33,48,33,48,33,33,33,33,33,33,33,33,33,48,
48,33,33,48,33,43,33,33,33,33,48,33,33,33,48,33,33,48,48,48,33,43,33,48,33,43,33,48,33,48,33,43,43,43,43,43,43,43,33,48,
48,48,48,48,33,43,33,33,33,33,48,33,43,33,48,33,33,48,48,48,33,43,33,48,33,43,33,33,33,48,33,33,33,33,33,33,33,33,33,48,
48,33,33,48,33,43,33,33,33,33,33,33,43,33,48,33,33,33,33,33,33,43,33,48,33,33,33,48,33,48,48,48,48,48,48,48,33,48,48,48,
48,40,38,33,33,43,33,48,33,33,48,33,43,33,48,33,33,33,33,33,33,43,33,48,48,48,48,48,33,48,33,33,33,33,48,33,33,33,33,48,
48,33,33,48,33,43,33,48,33,33,48,33,43,33,48,33,33,48,48,48,33,43,33,48,33,33,33,33,33,33,33,43,43,33,48,33,43,43,33,48,
48,48,48,48,33,43,33,48,33,33,48,33,33,33,33,33,33,48,48,48,33,43,33,33,33,43,43,43,33,48,33,43,43,33,48,33,33,33,33,48,
48,33,33,48,33,43,33,48,48,48,48,48,48,48,48,33,33,33,33,33,33,43,33,48,33,33,33,33,33,48,33,33,33,33,48,48,48,48,33,48,
48,40,38,33,33,43,33,48,33,33,33,33,33,33,48,33,43,43,43,43,43,43,33,48,48,48,33,48,48,48,48,48,48,48,48,33,33,48,33,48,
48,33,33,48,33,43,33,48,33,43,43,43,43,33,48,33,43,43,43,43,43,43,33,48,33,33,33,33,33,33,33,33,33,33,48,33,33,48,33,48,
48,48,48,48,33,43,33,33,33,43,43,43,43,33,48,33,33,33,33,33,33,33,33,48,33,43,43,43,43,43,43,43,43,33,48,33,33,33,33,48,
48,33,33,48,33,43,33,48,33,43,43,43,43,33,48,48,33,48,48,48,48,33,48,48,33,33,33,33,33,33,33,43,43,33,48,33,33,48,48,48,
48,40,38,33,33,43,33,48,33,43,43,43,43,33,48,33,33,33,33,48,33,33,33,48,48,48,48,48,48,33,48,33,33,33,48,33,33,33,33,48,
48,33,33,48,33,33,33,48,33,33,33,33,33,33,48,33,43,43,33,48,33,43,33,48,33,33,33,33,48,33,48,48,48,48,48,33,43,43,33,48,
48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,33,43,43,33,48,33,43,33,48,33,43,43,33,48,33,48,33,33,33,33,33,43,43,33,48,
48,33,33,33,33,33,33,48,33,33,33,48,33,33,48,33,33,33,33,48,33,43,33,48,33,43,43,33,48,33,48,33,43,43,43,33,33,33,33,48,
48,33,48,48,48,48,33,33,33,43,33,33,33,33,48,48,33,33,48,48,33,43,33,48,33,43,33,33,48,33,48,33,43,43,43,33,48,48,48,48,
48,33,48,37,34,48,33,48,33,33,33,48,33,33,48,33,33,33,33,48,33,43,33,48,33,43,33,48,48,33,48,48,33,33,33,33,33,33,33,48,
48,33,48,36,35,48,33,48,48,48,33,48,33,33,48,33,43,43,33,48,33,43,33,48,33,43,33,33,33,33,33,33,33,33,48,33,43,43,33,48,
48,33,48,48,48,48,33,48,33,33,33,48,33,33,33,33,43,43,33,48,33,43,33,48,33,43,43,43,43,43,43,43,43,33,48,33,43,43,33,48,
48,33,33,33,33,33,33,48,33,33,33,48,33,33,48,33,33,33,33,48,33,33,33,48,33,33,33,33,33,33,33,33,33,33,48,33,33,33,33,48,
48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48
};

const unsigned char map[MAP_WIDTH*MAP_HEIGHT] = {
10,5,5,5,5,5,5,5,11,28,26,28,11,28,32,28,11,28,26,28,11,5,28,26,28,5,5,11,5,5,5,5,5,5,5,5,5,5,5,7,
6,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,6,0,0,0,6,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,6,0,0,0,25,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,0,0,0,6,0,0,0,4,0,0,0,6,0,0,0,6,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,0,0,3,15,1,0,3,15,1,0,3,15,1,0,3,13,1,0,3,5,5,5,12,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,0,0,0,2,0,0,0,6,0,0,0,6,0,0,0,2,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,6,
14,5,5,5,5,7,0,0,0,0,0,0,6,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,2,0,0,4,0,0,0,6,0,0,0,6,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,10,5,5,5,5,5,5,12,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,4,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,14,5,5,13,5,11,5,13,5,11,5,13,5,5,5,8,0,3,7,0,4,0,6,0,0,0,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,2,0,0,0,0,2,0,0,0,6,0,0,0,0,0,0,0,0,6,0,6,0,9,5,11,1,0,3,11,5,5,5,5,5,12,
6,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,6,0,6,0,0,0,6,0,0,0,6,0,0,0,0,0,6,
6,0,0,0,0,4,0,0,0,0,4,0,0,0,6,0,0,0,0,0,0,0,0,6,0,14,5,7,0,6,0,0,0,6,0,0,0,0,0,6,
14,5,1,0,3,13,5,5,5,5,12,0,0,0,2,0,0,0,0,0,0,0,0,9,5,8,0,6,0,0,0,0,0,2,0,0,0,0,0,6,
27,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,10,5,7,0,0,0,0,0,0,0,9,5,7,0,0,0,0,0,0,0,0,0,6,
17,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,9,26,8,0,0,0,4,0,0,0,0,0,6,0,0,0,4,0,0,0,0,0,6,
17,0,0,4,0,0,0,0,0,0,4,0,0,0,6,0,0,0,0,0,0,0,0,22,16,16,16,18,0,14,1,0,3,13,5,5,5,5,5,12,
29,0,0,6,0,0,0,3,5,5,15,5,5,5,6,0,0,0,0,0,0,0,0,17,0,0,0,6,0,6,0,0,0,0,0,0,0,0,0,6,
27,0,0,6,0,0,0,0,0,0,6,0,0,0,6,0,0,10,5,7,0,0,0,29,0,0,0,2,0,6,0,0,0,0,0,0,0,0,0,6,
22,5,5,12,0,0,0,0,0,0,2,0,0,0,6,0,0,9,28,8,0,0,0,31,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,6,
25,0,0,2,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,17,0,0,0,4,0,14,5,5,5,5,11,1,0,3,5,12,
31,0,0,0,0,0,0,4,0,0,4,0,0,0,6,0,0,0,0,0,0,0,0,14,5,5,5,8,0,2,0,0,0,0,6,0,0,0,0,6,
27,0,0,4,0,0,0,6,0,0,6,0,0,0,2,0,0,10,5,7,0,0,0,2,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,6,
14,5,5,12,0,0,0,6,0,0,6,0,0,0,0,0,0,9,26,8,0,0,0,0,0,0,0,0,0,4,0,0,0,0,6,0,0,0,0,6,
27,0,0,2,0,0,0,14,5,5,13,5,5,5,7,0,0,0,0,0,0,0,0,4,0,0,0,0,0,6,0,0,0,0,14,5,5,7,0,6,
25,0,0,0,0,0,0,6,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,14,5,1,0,3,5,13,5,5,5,5,12,0,0,6,0,6,
29,0,0,4,0,0,0,2,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,6,
22,5,5,12,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,6,
25,0,0,2,0,0,0,4,0,0,0,0,0,0,14,1,0,3,5,11,1,0,3,12,0,0,0,0,0,0,0,0,0,0,6,0,0,3,5,12,
27,0,0,0,0,0,0,6,0,0,0,0,0,0,6,0,0,0,0,6,0,0,0,14,5,5,5,5,7,0,4,0,0,0,6,0,0,0,0,6,
6,0,0,4,0,0,0,6,0,0,0,0,0,0,6,0,0,0,0,6,0,0,0,6,0,0,0,0,6,0,14,5,5,5,8,0,0,0,0,6,
14,5,5,13,5,5,5,15,5,5,5,11,5,5,12,0,0,0,0,6,0,0,0,6,0,0,0,0,6,0,6,0,0,0,0,0,0,0,0,6,
6,0,0,0,0,0,0,2,0,0,0,2,0,0,6,0,0,0,0,6,0,0,0,6,0,0,0,0,6,0,6,0,0,0,0,0,0,0,0,6,
27,0,0,0,0,0,0,0,0,0,0,0,0,0,14,1,0,0,3,12,0,0,0,6,0,0,0,0,6,0,6,0,0,0,0,0,3,5,5,12,
25,0,0,0,0,0,0,6,0,0,0,4,0,0,6,0,0,0,0,6,0,0,0,6,0,0,0,3,8,0,9,1,0,0,0,0,0,0,0,6,
29,0,0,0,0,0,0,14,5,1,0,6,0,0,2,0,0,0,0,6,0,0,0,6,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,6,
27,0,0,0,0,0,0,6,0,0,0,6,0,0,0,0,0,0,0,6,0,0,0,6,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,6,
6,0,0,0,0,0,0,6,0,0,0,6,0,0,4,0,0,0,0,6,0,0,0,6,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,6,
9,5,5,5,5,5,5,13,5,5,5,13,5,5,13,5,5,5,5,13,5,5,5,13,5,5,5,5,5,5,5,5,5,5,13,5,5,5,5,8
};
